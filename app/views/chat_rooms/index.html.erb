<h3 class="mb-4 text-center" style="font-size:1.8rem; color:#2c3e50;">Your Quests</h3>

<div class="mb-3">
  <%= link_to "Back", root_path, class: "btn btn-secondary" %>
</div>

<%# Flash notice %>
<% if flash[:notice] %>
  <div class="alert alert-success mt-2">
    <%= flash[:notice] %>
  </div>
<% end %>

<div class="quests-container mx-auto" style="max-width: 700px; padding: 0 20px;">
  <% (@tasks + @invited_tasks).sort_by(&:created_at).each do |task| %>
    <%# Determine card color %>
    <% card_color = if task.duo_accepted?
                      "#d1f2eb"
                    elsif task.ignored
                      "grey"
                    else
                      "#f9f9f9"
                    end %>

    <div class="mb-4">
      <div class="card shadow-sm" style="border-radius:15px; background-color: <%= card_color %>;">
        <div class="card-header d-flex justify-content-between align-items-center"
             style="background-color:#3498db; color:white; font-weight:bold; border-top-left-radius:15px; border-top-right-radius:15px;">
          <span><%= task.name %></span>
          <% if task.completed %>
            <span class="badge bg-success" style="font-size:0.9rem;">Completed</span>
          <% else %>
            <span class="badge bg-warning text-dark" style="font-size:0.9rem;">Pending</span>
          <% end %>
        </div>

        <div class="card-body text-center" style="line-height:1.5; font-size:1rem;">
          <p class="card-text"><%= task.description %></p>
          <p>XP Reward: <strong><%= task.xp || 0 %> XP</strong></p>
          <% if task.daily? %>
            <p><em>Daily Quest</em></p>
          <% else %>
            <p><em>For <%= task.date.strftime("%d %b %Y") %></em></p>
          <% end %>

          <%# Participants partial %>
          <%= render "ask_for_help", task: task %>
        </div>

        <div class="task-item d-flex justify-content-end">
          <%= link_to edit_task_path(task), class: "edit_button fs-2 me-2" do %>
            ✏️
          <% end %>

          <% unless task.completed %>
            <% if task.ignored %>
              <%= button_to "Unfreeze", unignore_task_path(task), method: :patch,
                    class: "btn btn-primary btn-sm" %>
            <% else %>
              <%= button_to "Mark as Done", complete_task_path(task), method: :patch,
                    class: "btn btn-success btn-sm me-2" %>
              <%= button_to "Mark as Freeze", ignore_task_path(task), method: :patch,
                    class: "btn btn-warning btn-sm" %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="mt-4 text-center">
  <%= link_to "Add New Quest", new_task_path, class: "btn btn-primary btn-lg", style: "border-radius:12px;" %>
</div>
