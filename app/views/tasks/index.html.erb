<% if user_signed_in? %>
  <h3 class="mb-4 text-center" style="font-size:1.8rem; color:#2c3e50;">Your Quests</h3>

  <!-- Back button -->
  <div class="mb-3 back-link">
    <%= link_to "Back", root_path, class: "btn btn-secondary" %>
  </div>

  <div class="quests-container mx-auto" style="max-width: 700px; padding: 0 20px;">

    <!-- Pending Invitations -->
    <% if current_user.pending_invitations.any? %>
      <h4 class="mb-3">Invitations in Waiting</h4>
      <% current_user.pending_invitations.each do |task| %>
        <% tp = task.task_participants.find_by(user: current_user) %>
        <% next if tp&.status == "declined" %>
        <%= render "task_card", task: task, bg_color: "#f0f8ff" %>
      <% end %>
    <% end %>

    <!-- Created & Partner Quests -->
    <% all_tasks = (@tasks + @participating_tasks).uniq.sort_by(&:created_at).reverse %>
    <% if all_tasks.any? %>
      <h4 class="mb-3">Your Quests</h4>
      <% all_tasks.each do |task| %>
        <%= render "task_card", task: task %>
      <% end %>
    <% end %>
  </div>

  <!-- Add new quest button -->
  <div class="mt-4 text-center">
    <%= link_to "Add New Quest", new_task_path, class: "btn btn-primary btn-lg", style: "border-radius:12px;" %>
  </div>
<% else %>
  <%= render "public_home" %>
<% end %>

